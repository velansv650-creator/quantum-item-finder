<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quantum Item Finder</title>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } 
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* üî• FIREBASE CONFIG (UNCHANGED) */
const firebaseConfig = {
  apiKey: "AIzaSyCE21rVu1qcMtjnUhPmNHtef-GfqofnZf0",
  authDomain: "quantum-item-finder-4a990.firebaseapp.com",
  projectId: "quantum-item-finder-4a990",
  storageBucket: "quantum-item-finder-4a990.firebasestorage.app",
  messagingSenderId: "500012758966",
  appId: "1:500012758966:web:a63d60c776f6da1a9ff317"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* üîê LOGIN / SIGNUP */
window.loginSignup = async () => {
  const email = email.value;
  const password = password.value;
  try {
    await createUserWithEmailAndPassword(auth, email, password);
    alert("Signup successful ‚úÖ");
  } catch {
    await signInWithEmailAndPassword(auth, email, password);
    alert("Login successful ‚úÖ");
  }
};

/* üîì LOGOUT */
window.logout = async () => {
  await signOut(auth);
};

/* üîí SECURITY */
onAuthStateChanged(auth, user => {
  loginBox.style.display = user ? "none" : "block";
  appBox.style.display = user ? "block" : "none";
});

/* üì¶ PRE BOOK + WHATSAPP + QR */
window.preBook = async () => {
  const bookingId = "QIF-" + Date.now();

  await addDoc(collection(db, "bookings"), {
    item: item.value,
    area: area.value,
    bookingId,
    time: serverTimestamp()
  });

  const msg = `Quantum Item Finder Pre-Booking
Item: ${item.value}
Area: ${area.value}
Booking ID: ${bookingId}`;

  window.open(`https://wa.me/919876543210?text=${encodeURIComponent(msg)}`);

  qr.innerHTML = "";
  new QRCode(qr, bookingId);
};
</script>

<!-- QR CODE LIB -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<style>
body{background:#1e2a2f;font-family:Arial}
.box{background:#fff;max-width:360px;margin:40px auto;padding:20px;border-radius:12px}
input,select{width:100%;padding:10px;margin-top:8px}
button{width:100%;padding:10px;margin-top:10px;border:none;border-radius:6px;font-size:16px}
.blue{background:#3f51b5;color:white}
.green{background:#25D366;color:white}
.red{background:#e53935;color:white}
</style>
</head>

<body>

<!-- üîê LOGIN -->
<div class="box" id="loginBox">
<h2>üîê Login / Signup</h2>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button class="blue" onclick="loginSignup()">Login / Signup</button>
</div>

<!-- üîç APP -->
<div class="box" id="appBox" style="display:none">
<h2>üîç Item Search</h2>

<select id="item">
<option>Rice</option>
<option>Pen</option>
<option>Tablet</option>
</select>

<select id="area">
<option>T Nagar</option>
<option>Anna Nagar</option>
<option>Velachery</option>
<option>Tambaram</option>
<option>Adyar</option>
<option>OMR</option>
<option>Guindy</option>
<option>Perambur</option>
</select>

<button class="green" onclick="preBook()">Pre-Book (WhatsApp)</button>
<button class="blue" onclick="window.location.href='tel:9876543210'">üìû Call Shop</button>
<button class="red" onclick="logout()">Logout</button>

<h3>üì≤ QR / Booking ID</h3>
<div id="qr"></div>
</div>

</body>
</html>
